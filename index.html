<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Application de gestion de ch√®ques et carnets bancaires">
    <meta name="theme-color" content="#21808d">
    <title>Gestion de Ch√®ques</title>
    <link rel="icon" type="image/png" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üí≥</text></svg>">
    <style>
        :root {
            --color-white: rgba(255, 255, 255, 1);
            --color-black: rgba(0, 0, 0, 1);
            --color-cream-50: rgba(252, 252, 249, 1);
            --color-cream-100: rgba(255, 255, 253, 1);
            --color-gray-200: rgba(245, 245, 245, 1);
            --color-gray-300: rgba(167, 169, 169, 1);
            --color-gray-400: rgba(119, 124, 124, 1);
            --color-slate-500: rgba(98, 108, 113, 1);
            --color-brown-600: rgba(94, 82, 64, 1);
            --color-charcoal-700: rgba(31, 33, 33, 1);
            --color-charcoal-800: rgba(38, 40, 40, 1);
            --color-slate-900: rgba(19, 52, 59, 1);
            --color-teal-300: rgba(50, 184, 198, 1);
            --color-teal-400: rgba(45, 166, 178, 1);
            --color-teal-500: rgba(33, 128, 141, 1);
            --color-teal-600: rgba(29, 116, 128, 1);
            --color-teal-700: rgba(26, 104, 115, 1);
            --color-red-400: rgba(255, 84, 89, 1);
            --color-red-500: rgba(192, 21, 47, 1);
            --color-orange-400: rgba(230, 129, 97, 1);
            --color-orange-500: rgba(168, 75, 47, 1);
            --color-brown-600-rgb: 94, 82, 64;
            --color-teal-500-rgb: 33, 128, 141;
            --color-slate-900-rgb: 19, 52, 59;
            --color-slate-500-rgb: 98, 108, 113;
            --color-red-500-rgb: 192, 21, 47;
            --color-orange-500-rgb: 168, 75, 47;
            --color-background: var(--color-cream-50);
            --color-surface: var(--color-cream-100);
            --color-text: var(--color-slate-900);
            --color-text-secondary: var(--color-slate-500);
            --color-primary: var(--color-teal-500);
            --color-primary-hover: var(--color-teal-600);
            --color-primary-active: var(--color-teal-700);
            --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
            --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
            --color-border: rgba(var(--color-brown-600-rgb), 0.2);
            --color-btn-primary-text: var(--color-cream-50);
            --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
            --color-error: var(--color-red-500);
            --color-success: var(--color-teal-500);
            --color-warning: var(--color-orange-500);
            --color-focus-ring: rgba(var(--color-teal-500-rgb), 0.4);
            --color-success-rgb: 33, 128, 141;
            --color-error-rgb: 192, 21, 47;
            --color-warning-rgb: 168, 75, 47;
            --font-family-base: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            --font-size-sm: 12px;
            --font-size-base: 14px;
            --font-size-lg: 16px;
            --font-size-xl: 18px;
            --font-size-2xl: 20px;
            --font-size-3xl: 24px;
            --space-4: 4px;
            --space-8: 8px;
            --space-12: 12px;
            --space-16: 16px;
            --space-20: 20px;
            --space-24: 24px;
            --space-32: 32px;
            --radius-sm: 6px;
            --radius-base: 8px;
            --radius-lg: 12px;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04);
            --duration-normal: 250ms;
            --ease-standard: cubic-bezier(0.16, 1, 0.3, 1);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --color-gray-400-rgb: 119, 124, 124;
                --color-teal-300-rgb: 50, 184, 198;
                --color-gray-300-rgb: 167, 169, 169;
                --color-gray-200-rgb: 245, 245, 245;
                --color-background: var(--color-charcoal-700);
                --color-surface: var(--color-charcoal-800);
                --color-text: var(--color-gray-200);
                --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
                --color-primary: var(--color-teal-300);
                --color-primary-hover: var(--color-teal-400);
                --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
                --color-secondary-hover: rgba(var(--color-gray-400-rgb), 0.25);
                --color-border: rgba(var(--color-gray-400-rgb), 0.3);
                --color-error: var(--color-red-400);
                --color-success: var(--color-teal-300);
                --color-warning: var(--color-orange-400);
                --color-btn-primary-text: var(--color-slate-900);
                --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
                --color-success-rgb: var(--color-teal-300-rgb);
                --color-error-rgb: 255, 84, 89;
                --color-warning-rgb: 230, 129, 97;
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family-base);
            background: var(--color-background);
            color: var(--color-text);
            padding: var(--space-20);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: var(--space-32);
        }

        h1 {
            font-size: var(--font-size-3xl);
            font-weight: 600;
            margin-bottom: var(--space-8);
            color: var(--color-text);
        }

        .tabs {
            display: flex;
            gap: var(--space-8);
            margin-bottom: var(--space-24);
            border-bottom: 2px solid var(--color-border);
            overflow-x: auto;
        }

        .tab-btn {
            padding: var(--space-12) var(--space-20);
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            color: var(--color-text-secondary);
            font-size: var(--font-size-base);
            font-weight: 500;
            cursor: pointer;
            transition: all var(--duration-normal) var(--ease-standard);
            white-space: nowrap;
        }

        .tab-btn:hover {
            color: var(--color-primary);
        }

        .tab-btn.active {
            color: var(--color-primary);
            border-bottom-color: var(--color-primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: var(--color-surface);
            border: 1px solid var(--color-card-border);
            border-radius: var(--radius-lg);
            padding: var(--space-24);
            margin-bottom: var(--space-20);
            box-shadow: var(--shadow-sm);
        }

        .form-group {
            margin-bottom: var(--space-16);
        }

        label {
            display: block;
            margin-bottom: var(--space-8);
            font-weight: 500;
            font-size: var(--font-size-sm);
            color: var(--color-text);
        }

        input, select, textarea {
            width: 100%;
            padding: var(--space-12);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            font-size: var(--font-size-base);
            background: var(--color-surface);
            color: var(--color-text);
            font-family: var(--font-family-base);
            transition: border-color var(--duration-normal) var(--ease-standard);
        }

        input:focus, select:focus, textarea:focus {
            outline: 2px solid var(--color-primary);
            border-color: var(--color-primary);
        }

        .btn {
            padding: var(--space-12) var(--space-20);
            border: none;
            border-radius: var(--radius-base);
            font-size: var(--font-size-base);
            font-weight: 500;
            cursor: pointer;
            transition: all var(--duration-normal) var(--ease-standard);
        }

        .btn-primary {
            background: var(--color-primary);
            color: var(--color-btn-primary-text);
        }

        .btn-primary:hover {
            background: var(--color-primary-hover);
        }

        .btn-secondary {
            background: var(--color-secondary);
            color: var(--color-text);
        }

        .btn-secondary:hover {
            background: var(--color-secondary-hover);
        }

        .btn-danger {
            background: var(--color-error);
            color: white;
        }

        .btn-danger:hover {
            opacity: 0.9;
        }

        .btn-sm {
            padding: var(--space-8) var(--space-12);
            font-size: var(--font-size-sm);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-16);
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        .btn-group {
            display: flex;
            gap: var(--space-12);
            margin-top: var(--space-20);
        }

        .cheque-list {
            margin-top: var(--space-24);
        }

        .cheque-item {
            background: var(--color-surface);
            border: 1px solid var(--color-card-border);
            border-radius: var(--radius-base);
            padding: var(--space-16);
            margin-bottom: var(--space-12);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: box-shadow var(--duration-normal) var(--ease-standard);
        }

        .cheque-item:hover {
            box-shadow: var(--shadow-md);
        }

        .cheque-info {
            flex: 1;
        }

        .cheque-info h3 {
            font-size: var(--font-size-lg);
            margin-bottom: var(--space-4);
            color: var(--color-text);
        }

        .cheque-info p {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            margin: var(--space-4) 0;
        }

        .cheque-actions {
            display: flex;
            gap: var(--space-8);
        }

        .status-badge {
            display: inline-block;
            padding: var(--space-4) var(--space-12);
            border-radius: 50px;
            font-size: var(--font-size-sm);
            font-weight: 500;
        }

        .status-emis {
            background: rgba(var(--color-warning-rgb), 0.15);
            color: var(--color-warning);
        }

        .status-encaisse {
            background: rgba(var(--color-success-rgb), 0.15);
            color: var(--color-success);
        }

        .status-annule {
            background: rgba(var(--color-error-rgb), 0.15);
            color: var(--color-error);
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--space-16);
            margin-bottom: var(--space-24);
        }

        .summary-card {
            background: var(--color-surface);
            border: 1px solid var(--color-card-border);
            border-radius: var(--radius-lg);
            padding: var(--space-20);
            text-align: center;
        }

        .summary-card h3 {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            margin-bottom: var(--space-8);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .summary-card .amount {
            font-size: var(--font-size-2xl);
            font-weight: 600;
            color: var(--color-primary);
        }

        .filter-section {
            display: flex;
            gap: var(--space-12);
            margin-bottom: var(--space-20);
            flex-wrap: wrap;
        }

        .filter-section select, .filter-section input {
            flex: 1;
            min-width: 200px;
        }

        .empty-state {
            text-align: center;
            padding: var(--space-32);
            color: var(--color-text-secondary);
        }

        .empty-state svg {
            width: 64px;
            height: 64px;
            margin-bottom: var(--space-16);
            opacity: 0.3;
        }

        .carnet-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-12);
        }

        .carnet-info-item {
            background: var(--color-secondary);
            padding: var(--space-12);
            border-radius: var(--radius-base);
        }

        .carnet-info-item strong {
            display: block;
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            margin-bottom: var(--space-4);
        }

        .carnet-info-item span {
            font-size: var(--font-size-base);
            color: var(--color-text);
        }

        .export-btn {
            display: inline-flex;
            align-items: center;
            gap: var(--space-8);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üí≥ Gestion de Ch√®ques</h1>
            <p style="color: var(--color-text-secondary);">G√©rez vos ch√®ques et carnets bancaires facilement</p>
        </header>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('dashboard')">Tableau de Bord</button>
            <button class="tab-btn" onclick="switchTab('cheques')">Ch√®ques</button>
            <button class="tab-btn" onclick="switchTab('carnets')">Carnets</button>
            <button class="tab-btn" onclick="switchTab('comptes')">Comptes Bancaires</button>
        </div>

        <div id="dashboard" class="tab-content active">
            <div class="summary-grid">
                <div class="summary-card">
                    <h3>Total Ch√®ques</h3>
                    <div class="amount" id="totalCheques">0</div>
                </div>
                <div class="summary-card">
                    <h3>Ch√®ques √âmis</h3>
                    <div class="amount" id="chequesEmis">0</div>
                </div>
                <div class="summary-card">
                    <h3>Ch√®ques Encaiss√©s</h3>
                    <div class="amount" id="chequesEncaisses">0</div>
                </div>
                <div class="summary-card">
                    <h3>Montant Total</h3>
                    <div class="amount" id="montantTotal">0 DA</div>
                </div>
            </div>

            <div class="card">
                <h2 style="margin-bottom: var(--space-16);">Ch√®ques R√©cents</h2>
                <div id="recentCheques"></div>
            </div>
        </div>

        <div id="cheques" class="tab-content">
            <div class="card">
                <h2 style="margin-bottom: var(--space-20);">Ajouter un Ch√®que</h2>
                <form id="chequeForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="numeroCheque">Num√©ro de Ch√®que *</label>
                            <input type="text" id="numeroCheque" required>
                        </div>
                        <div class="form-group">
                            <label for="compte">Compte Bancaire *</label>
                            <select id="compte" required>
                                <option value="">S√©lectionner un compte</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="montant">Montant (DA) *</label>
                            <input type="number" id="montant" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="dateCheque">Date du Ch√®que *</label>
                            <input type="date" id="dateCheque" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="beneficiaire">B√©n√©ficiaire *</label>
                            <input type="text" id="beneficiaire" required>
                        </div>
                        <div class="form-group">
                            <label for="statut">Statut *</label>
                            <select id="statut" required>
                                <option value="emis">√âmis</option>
                                <option value="encaisse">Encaiss√©</option>
                                <option value="annule">Annul√©</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="notes">Notes</label>
                        <textarea id="notes" rows="3"></textarea>
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">Enregistrer le Ch√®que</button>
                        <button type="reset" class="btn btn-secondary">R√©initialiser</button>
                    </div>
                </form>
            </div>

            <div class="card">
                <h2 style="margin-bottom: var(--space-20);">Liste des Ch√®ques</h2>
                <div class="filter-section">
                    <select id="filterCompte" onchange="filterCheques()">
                        <option value="">Tous les comptes</option>
                    </select>
                    <select id="filterStatut" onchange="filterCheques()">
                        <option value="">Tous les statuts</option>
                        <option value="emis">√âmis</option>
                        <option value="encaisse">Encaiss√©</option>
                        <option value="annule">Annul√©</option>
                    </select>
                    <input type="text" id="filterBeneficiaire" placeholder="Rechercher par b√©n√©ficiaire..." onkeyup="filterCheques()">
                </div>
                <div class="btn-group">
                    <button class="btn btn-secondary export-btn" onclick="exportToExcel()">
                        <span>üìä</span> Exporter vers Excel
                    </button>
                </div>
                <div id="chequeList" class="cheque-list"></div>
            </div>
        </div>

        <div id="carnets" class="tab-content">
            <div class="card">
                <h2 style="margin-bottom: var(--space-20);">Ajouter un Carnet de Ch√®ques</h2>
                <form id="carnetForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="carnetCompte">Compte Bancaire *</label>
                            <select id="carnetCompte" required>
                                <option value="">S√©lectionner un compte</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="dateReception">Date de R√©ception *</label>
                            <input type="date" id="dateReception" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="premierCheque">Premier Num√©ro *</label>
                            <input type="text" id="premierCheque" required>
                        </div>
                        <div class="form-group">
                            <label for="dernierCheque">Dernier Num√©ro *</label>
                            <input type="text" id="dernierCheque" required>
                        </div>
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">Enregistrer le Carnet</button>
                        <button type="reset" class="btn btn-secondary">R√©initialiser</button>
                    </div>
                </form>
            </div>

            <div class="card">
                <h2 style="margin-bottom: var(--space-20);">Carnets de Ch√®ques</h2>
                <div id="carnetList" class="cheque-list"></div>
            </div>
        </div>

        <div id="comptes" class="tab-content">
            <div class="card">
                <h2 style="margin-bottom: var(--space-20);">Ajouter un Compte Bancaire</h2>
                <form id="compteForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="nomCompte">Nom du Compte *</label>
                            <input type="text" id="nomCompte" required>
                        </div>
                        <div class="form-group">
                            <label for="numeroCompte">Num√©ro de Compte *</label>
                            <input type="text" id="numeroCompte" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="banque">Banque *</label>
                            <input type="text" id="banque" required>
                        </div>
                        <div class="form-group">
                            <label for="rib">RIB</label>
                            <input type="text" id="rib">
                        </div>
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">Ajouter le Compte</button>
                        <button type="reset" class="btn btn-secondary">R√©initialiser</button>
                    </div>
                </form>
            </div>

            <div class="card">
                <h2 style="margin-bottom: var(--space-20);">Comptes Bancaires</h2>
                <div id="compteList" class="cheque-list"></div>
            </div>
        </div>
    </div>

    <script>
        let comptes = JSON.parse(localStorage.getItem('comptes')) || [];
        let cheques = JSON.parse(localStorage.getItem('cheques')) || [];
        let carnets = JSON.parse(localStorage.getItem('carnets')) || [];

        function saveData() {
            localStorage.setItem('comptes', JSON.stringify(comptes));
            localStorage.setItem('cheques', JSON.stringify(cheques));
            localStorage.setItem('carnets', JSON.stringify(carnets));
        }

        function requestNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
        }

        function sendNotification(title, body) {
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification(title, {
                    body: body,
                    icon: 'üí≥',
                    badge: 'üí≥'
                });
            }
        }

        function switchTab(tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            const buttons = document.querySelectorAll('.tab-btn');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            buttons.forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'dashboard') {
                updateDashboard();
            }
        }

        function updateDashboard() {
            const totalCheques = cheques.length;
            const chequesEmis = cheques.filter(c => c.statut === 'emis').length;
            const chequesEncaisses = cheques.filter(c => c.statut === 'encaisse').length;
            const montantTotal = cheques.reduce((sum, c) => sum + parseFloat(c.montant || 0), 0);

            document.getElementById('totalCheques').textContent = totalCheques;
            document.getElementById('chequesEmis').textContent = chequesEmis;
            document.getElementById('chequesEncaisses').textContent = chequesEncaisses;
            document.getElementById('montantTotal').textContent = montantTotal.toFixed(2) + ' DA';

            const recentDiv = document.getElementById('recentCheques');
            const recentCheques = cheques.slice(-5).reverse();
            
            if (recentCheques.length === 0) {
                recentDiv.innerHTML = '<div class="empty-state"><p>Aucun ch√®que enregistr√©</p></div>';
            } else {
                recentDiv.innerHTML = recentCheques.map(cheque => {
                    const compte = comptes.find(c => c.id === cheque.compteId);
                    return `
                        <div class="cheque-item">
                            <div class="cheque-info">
                                <h3>Ch√®que N¬∞ ${cheque.numero}</h3>
                                <p><strong>B√©n√©ficiaire:</strong> ${cheque.beneficiaire}</p>
                                <p><strong>Montant:</strong> ${parseFloat(cheque.montant).toFixed(2)} DA</p>
                                <p><strong>Date:</strong> ${new Date(cheque.date).toLocaleDateString('fr-FR')}</p>
                                <p><strong>Compte:</strong> ${compte ? compte.nom : 'Inconnu'}</p>
                                <span class="status-badge status-${cheque.statut}">${getStatutLabel(cheque.statut)}</span>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        function getStatutLabel(statut) {
            const labels = {
                'emis': '√âmis',
                'encaisse': 'Encaiss√©',
                'annule': 'Annul√©'
            };
            return labels[statut] || statut;
        }

        function updateCompteSelects() {
            const selects = [
                document.getElementById('compte'),
                document.getElementById('carnetCompte'),
                document.getElementById('filterCompte')
            ];

            selects.forEach(select => {
                const currentValue = select.value;
                const isFilter = select.id === 'filterCompte';
                
                select.innerHTML = isFilter ? '<option value="">Tous les comptes</option>' : '<option value="">S√©lectionner un compte</option>';
                
                comptes.forEach(compte => {
                    const option = document.createElement('option');
                    option.value = compte.id;
                    option.textContent = `${compte.nom} - ${compte.banque}`;
                    select.appendChild(option);
                });
                
                select.value = currentValue;
            });
        }

        document.getElementById('compteForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const compte = {
                id: Date.now().toString(),
                nom: document.getElementById('nomCompte').value,
                numero: document.getElementById('numeroCompte').value,
                banque: document.getElementById('banque').value,
                rib: document.getElementById('rib').value
            };
            
            comptes.push(compte);
            saveData();
            updateCompteSelects();
            displayComptes();
            this.reset();
            sendNotification('Compte Ajout√©', `Le compte ${compte.nom} a √©t√© ajout√© avec succ√®s`);
            alert('Compte ajout√© avec succ√®s!');
        });

        function displayComptes() {
            const list = document.getElementById('compteList');
            
            if (comptes.length === 0) {
                list.innerHTML = '<div class="empty-state"><p>Aucun compte bancaire enregistr√©</p></div>';
                return;
            }
            
            list.innerHTML = comptes.map(compte => `
                <div class="cheque-item">
                    <div class="cheque-info">
                        <h3>${compte.nom}</h3>
                        <p><strong>Banque:</strong> ${compte.banque}</p>
                        <p><strong>Num√©ro:</strong> ${compte.numero}</p>
                        ${compte.rib ? `<p><strong>RIB:</strong> ${compte.rib}</p>` : ''}
                    </div>
                    <div class="cheque-actions">
                        <button class="btn btn-danger btn-sm" onclick="deleteCompte('${compte.id}')">Supprimer</button>
                    </div>
                </div>
            `).join('');
        }

        function deleteCompte(id) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer ce compte?')) {
                comptes = comptes.filter(c => c.id !== id);
                saveData();
                updateCompteSelects();
                displayComptes();
            }
        }

        document.getElementById('chequeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const cheque = {
                id: Date.now().toString(),
                numero: document.getElementById('numeroCheque').value,
                compteId: document.getElementById('compte').value,
                montant: document.getElementById('montant').value,
                date: document.getElementById('dateCheque').value,
                beneficiaire: document.getElementById('beneficiaire').value,
                statut: document.getElementById('statut').value,
                notes: document.getElementById('notes').value
            };
            
            cheques.push(cheque);
            saveData();
            displayCheques();
            updateDashboard();
            this.reset();
            sendNotification('Ch√®que Enregistr√©', `Ch√®que N¬∞ ${cheque.numero} pour ${cheque.beneficiaire} - ${parseFloat(cheque.montant).toFixed(2)} DA`);
            alert('Ch√®que enregistr√© avec succ√®s!');
        });

        function displayCheques() {
            filterCheques();
        }

        function filterCheques() {
            const filterCompte = document.getElementById('filterCompte').value;
            const filterStatut = document.getElementById('filterStatut').value;
            const filterBenef = document.getElementById('filterBeneficiaire').value.toLowerCase();
            
            let filtered = cheques.filter(cheque => {
                const matchCompte = !filterCompte || cheque.compteId === filterCompte;
                const matchStatut = !filterStatut || cheque.statut === filterStatut;
                const matchBenef = !filterBenef || cheque.beneficiaire.toLowerCase().includes(filterBenef);
                return matchCompte && matchStatut && matchBenef;
            });
            
            const list = document.getElementById('chequeList');
            
            if (filtered.length === 0) {
                list.innerHTML = '<div class="empty-state"><p>Aucun ch√®que trouv√©</p></div>';
                return;
            }
            
            list.innerHTML = filtered.map(cheque => {
                const compte = comptes.find(c => c.id === cheque.compteId);
                return `
                    <div class="cheque-item">
                        <div class="cheque-info">
                            <h3>Ch√®que N¬∞ ${cheque.numero}</h3>
                            <p><strong>Compte:</strong> ${compte ? compte.nom : 'Inconnu'}</p>
                            <p><strong>B√©n√©ficiaire:</strong> ${cheque.beneficiaire}</p>
                            <p><strong>Montant:</strong> ${parseFloat(cheque.montant).toFixed(2)} DA</p>
                            <p><strong>Date:</strong> ${new Date(cheque.date).toLocaleDateString('fr-FR')}</p>
                            ${cheque.notes ? `<p><strong>Notes:</strong> ${cheque.notes}</p>` : ''}
                            <span class="status-badge status-${cheque.statut}">${getStatutLabel(cheque.statut)}</span>
                        </div>
                        <div class="cheque-actions">
                            <button class="btn btn-secondary btn-sm" onclick="editCheque('${cheque.id}')">Modifier</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteCheque('${cheque.id}')">Supprimer</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function editCheque(id) {
            const cheque = cheques.find(c => c.id === id);
            if (!cheque) return;
            
            document.getElementById('numeroCheque').value = cheque.numero;
            document.getElementById('compte').value = cheque.compteId;
            document.getElementById('montant').value = cheque.montant;
            document.getElementById('dateCheque').value = cheque.date;
            document.getElementById('beneficiaire').value = cheque.beneficiaire;
            document.getElementById('statut').value = cheque.statut;
            document.getElementById('notes').value = cheque.notes;
            
            deleteCheque(id);
            switchTab('cheques');
            document.querySelector('[onclick="switchTab(\'cheques\')"]').click();
            window.scrollTo(0, 0);
        }

        function deleteCheque(id) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer ce ch√®que?')) {
                cheques = cheques.filter(c => c.id !== id);
                saveData();
                displayCheques();
                updateDashboard();
            }
        }

        document.getElementById('carnetForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const carnet = {
                id: Date.now().toString(),
                compteId: document.getElementById('carnetCompte').value,
                dateReception: document.getElementById('dateReception').value,
                premierCheque: document.getElementById('premierCheque').value,
                dernierCheque: document.getElementById('dernierCheque').value
            };
            
            carnets.push(carnet);
            saveData();
            displayCarnets();
            this.reset();
            sendNotification('Carnet Enregistr√©', `Nouveau carnet ajout√© avec succ√®s`);
            alert('Carnet enregistr√© avec succ√®s!');
        });

        function displayCarnets() {
            const list = document.getElementById('carnetList');
            
            if (carnets.length === 0) {
                list.innerHTML = '<div class="empty-state"><p>Aucun carnet de ch√®ques enregistr√©</p></div>';
                return;
            }
            
            list.innerHTML = carnets.map(carnet => {
                const compte = comptes.find(c => c.id === carnet.compteId);
                const nbCheques = parseInt(carnet.dernierCheque) - parseInt(carnet.premierCheque) + 1;
                
                return `
                    <div class="cheque-item" style="flex-direction: column; align-items: stretch;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--space-16);">
                            <div class="cheque-info">
                                <h3>Carnet - ${compte ? compte.nom : 'Compte inconnu'}</h3>
                                <p><strong>Date de r√©ception:</strong> ${new Date(carnet.dateReception).toLocaleDateString('fr-FR')}</p>
                                <p><strong>Nombre de ch√®ques:</strong> ${nbCheques}</p>
                            </div>
                            <div class="cheque-actions">
                                <button class="btn btn-danger btn-sm" onclick="deleteCarnet('${carnet.id}')">Supprimer</button>
                            </div>
                        </div>
                        <div class="carnet-info">
                            <div class="carnet-info-item">
                                <strong>Premier Ch√®que</strong>
                                <span>${carnet.premierCheque}</span>
                            </div>
                            <div class="carnet-info-item">
                                <strong>Dernier Ch√®que</strong>
                                <span>${carnet.dernierCheque}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function deleteCarnet(id) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer ce carnet?')) {
                carnets = carnets.filter(c => c.id !== id);
                saveData();
                displayCarnets();
            }
        }

        function exportToExcel() {
            if (cheques.length === 0) {
                alert('Aucun ch√®que √† exporter');
                return;
            }

            let csv = 'Num√©ro,Compte,Banque,B√©n√©ficiaire,Montant (DA),Date,Statut,Notes\n';
            
            cheques.forEach(cheque => {
                const compte = comptes.find(c => c.id === cheque.compteId);
                csv += `"${cheque.numero}","${compte ? compte.nom : 'Inconnu'}","${compte ? compte.banque : ''}","${cheque.beneficiaire}","${cheque.montant}","${cheque.date}","${getStatutLabel(cheque.statut)}","${cheque.notes || ''}"\n`;
            });

            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `cheques_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        const manifestData = {
            "name": "Gestion de Ch√®ques",
            "short_name": "Ch√®ques",
            "description": "Application de gestion de ch√®ques et carnets bancaires",
            "start_url": "./",
            "display": "standalone",
            "background_color": "#fcfcf9",
            "theme_color": "#21808d",
            "orientation": "portrait",
            "icons": [
                {
                    "src": "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><rect width='192' height='192' fill='%2321808d'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-size='120' fill='white'>üí≥</text></svg>",
                    "sizes": "192x192",
                    "type": "image/svg+xml",
                    "purpose": "any maskable"
                },
                {
                    "src": "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><rect width='512' height='512' fill='%2321808d'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-size='320' fill='white'>üí≥</text></svg>",
                    "sizes": "512x512",
                    "type": "image/svg+xml",
                    "purpose": "any maskable"
                }
            ]
        };

        const manifestBlob = new Blob([JSON.stringify(manifestData)], { type: 'application/json' });
        const manifestURL = URL.createObjectURL(manifestBlob);
        const manifestLink = document.createElement('link');
        manifestLink.rel = 'manifest';
        manifestLink.href = manifestURL;
        document.head.appendChild(manifestLink);

        if ('serviceWorker' in navigator) {
            const swCode = `
                const CACHE_NAME = 'gestion-cheques-v1';
                const urlsToCache = ['./', './index.html'];
                
                self.addEventListener('install', event => {
                    event.waitUntil(
                        caches.open(CACHE_NAME)
                            .then(cache => cache.addAll(urlsToCache))
                    );
                });
                
                self.addEventListener('fetch', event => {
                    event.respondWith(
                        caches.match(event.request)
                            .then(response => response || fetch(event.request))
                    );
                });
            `;
            
            const swBlob = new Blob([swCode], { type: 'application/javascript' });
            const swURL = URL.createObjectURL(swBlob);
            
            navigator.serviceWorker.register(swURL)
                .then(registration => console.log('Service Worker enregistr√©'))
                .catch(err => console.log('Erreur Service Worker:', err));
        }

        window.addEventListener('load', function() {
            requestNotificationPermission();
            updateDashboard();
            displayComptes();
            displayCheques();
            displayCarnets();
        });
    </script>
</body>
</html>

